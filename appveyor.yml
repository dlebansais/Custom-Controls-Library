# version format
version: 1.0.{build}

# branches to build
branches:
  # whitelist
  only:
    - master

  # blacklist
  except:
    - gh-pages

# Skipping commits with particular message or from specific user
skip_commits:
  message: "*[skip ci]*"

# Build worker image (VM template)
image: Visual Studio 2019

# scripts that are called at very beginning, before repo cloning
init:
  - git config --global core.autocrlf input

# this is how to allow failing jobs in the matrix
matrix:
  fast_finish: true     # set this flag to immediately finish build once one of the jobs fails.

# scripts to run before build
before_build:
  - nuget restore Custom-Controls-Library.sln

# path to Visual Studio solution or project
build:
  project: Custom-Controls-Library.sln

platform: x64
configuration: Release

after_build:
  - dotnet pack --configuration Release /p:Platform=x64 Custom-Controls-Library/Custom-Controls-Library.csproj

test: off

artifacts:
  - path: Custom-Controls-Library/bin/
    name: Custom-Controls-Library-Release
  - path: Custom-Controls-Library/bin/x64/Release/Custom-Controls-Library.*.nupkg
    name: Custom-Controls-Library-Package

deploy:
  - provider: GitHub
    release: '%APPVEYOR_REPO_TAG_NAME%'
    description: '%APPVEYOR_REPO_COMMIT_MESSAGE%'
    auth_token:
      secure: dUpQSnUT5/m88z1BqHNnRjaxxZzz09CmyqFJr/cAyWjqKeLgnKunlIZlEKAXlNIm
    artifact: Custom-Controls-Library-Release
    draft: true
    prerelease: false
    on:
      branch: master
      APPVEYOR_REPO_TAG: true
  - provider: NuGet
    server: https://nuget.pkg.github.com/dlebansais/index.json
    artifact: Custom-Controls-Library-Package
    username: dlebansais
    api_key:
      secure: GOksqNi8I7Vs6dcsfosJvSa9vMaZH3zLQJjnx+ruJy6ZeLF075mifj4MdRI34E8W
    skip_symbols: true
